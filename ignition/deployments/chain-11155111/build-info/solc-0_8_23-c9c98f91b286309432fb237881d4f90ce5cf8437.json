{
  "_format": "hh3-sol-build-info-1",
  "id": "solc-0_8_23-c9c98f91b286309432fb237881d4f90ce5cf8437",
  "solcVersion": "0.8.23",
  "solcLongVersion": "0.8.23+commit.f704f362",
  "userSourceNameMap": {
    "contracts/EventFactory.sol": "project/contracts/EventFactory.sol"
  },
  "input": {
    "language": "Solidity",
    "settings": {
      "evmVersion": "shanghai",
      "optimizer": {
        "enabled": true,
        "runs": 200
      },
      "outputSelection": {
        "*": {
          "": [
            "ast"
          ],
          "*": [
            "abi",
            "evm.bytecode",
            "evm.deployedBytecode",
            "evm.methodIdentifiers",
            "metadata"
          ]
        }
      },
      "remappings": [],
      "viaIR": true
    },
    "sources": {
      "project/contracts/EventContract.sol": {
        "content": "// SPDX-License-Identifier: MIT\npragma solidity ^0.8.23;\n\ncontract EventContract {\n    address public organizer;\n    string public name;\n    string public date; \n    string public time;\n    string public imageURL;\n    \n    string public locationName;\n    string public city;        \n    string public country;     \n    string public mapsLink;    \n\n    uint256 public price;\n    uint256 public capacity;\n    uint256 public soldCount;\n    \n    uint256 public eventTimestamp; // ğŸ•’ Zaman DamgasÄ±\n\n    bool public isCancelled = false;\n\n    mapping(address => bool) public hasTicket;\n    mapping(address => bool) public isRefunded;\n\n    // âœ… Biletin kapÄ±da bir kez okutulmasÄ±nÄ± takip etmek iÃ§in\n    mapping(address => bool) public isTicketUsed;\n\n    event TicketSold(address indexed buyer, uint256 ticketId);\n    event EventCancelled();\n    event TicketUsed(address indexed user, uint256 timestamp);\n\n    constructor(\n        address _organizer,\n        string memory _name,\n        string memory _date,\n        string memory _time,\n        string memory _imageURL,\n        string memory _locationName,\n        string memory _city,        \n        string memory _country,     \n        string memory _mapsLink,    \n        uint256 _price,\n        uint256 _capacity,\n        uint256 _eventTimestamp \n    ) {\n        organizer = _organizer;\n        name = _name;\n        date = _date;\n        time = _time;\n        imageURL = _imageURL;\n        locationName = _locationName;\n        city = _city;\n        country = _country;\n        mapsLink = _mapsLink;\n        price = _price;\n        capacity = _capacity;\n        soldCount = 0;\n        eventTimestamp = _eventTimestamp;\n    }\n\n    function buyTicket() external payable {\n        require(!isCancelled, \"Etkinlik iptal edildi\");\n\n        // ğŸ›¡ï¸ GUVENLIK 1: Etkinlik zamanÄ± geÃ§tiyse bilet satÄ±ÅŸÄ± durur\n        require(block.timestamp < eventTimestamp, \"Satislar kapandi, etkinlik basladi/bitti\"); \n        \n        require(msg.value == price, \"Yanlis miktar\");\n        require(soldCount < capacity, \"Dolu\");\n        require(!hasTicket[msg.sender], \"Zaten biletin var\");\n        \n        hasTicket[msg.sender] = true;\n\n        // ğŸ”„ AynÄ± cÃ¼zdan daha once iade almis veya kullanmis olsa bile,\n        // yeni bilette durumlar baÅŸtan baÅŸlar:\n        isRefunded[msg.sender] = false;\n        isTicketUsed[msg.sender] = false;\n\n        soldCount++;\n        emit TicketSold(msg.sender, soldCount);\n    }\n\n    function cancelEvent() external {\n        require(msg.sender == organizer, \"Yetkisiz\");\n        require(!isCancelled, \"Zaten iptal\");\n\n        // ğŸ›¡ï¸ GUVENLIK 2: Etkinlik bittikten sonra organizatÃ¶r iptal edemez\n        require(block.timestamp < eventTimestamp, \"Gecmis etkinlik iptal edilemez\");\n        \n        isCancelled = true;\n        emit EventCancelled();\n    }\n\n    function getRefund() external {\n        require(isCancelled, \"Iptal degil\");\n        require(hasTicket[msg.sender], \"Bileti yok\");\n\n        // ğŸ›¡ï¸ KullanilmÄ±ÅŸ bilet iade almasÄ±n (double spend engeli)\n        require(!isTicketUsed[msg.sender], \"Bilet kullanilmis, iade olmaz\");\n\n        require(!isRefunded[msg.sender], \"Iade alindi\");\n        \n        isRefunded[msg.sender] = true;\n        hasTicket[msg.sender] = false;\n        \n        payable(msg.sender).transfer(price);\n    }\n\n    function withdraw() external {\n        require(msg.sender == organizer, \"Yetkisiz\");\n        require(!isCancelled, \"Etkinlik iptal edilmis, para cekilemez!\");\n\n        // ğŸ›¡ï¸ GUVENLIK 3: Rug Pull KorumasÄ± (TimeLock)\n        require(block.timestamp > eventTimestamp, \"Etkinlik bitmeden para cekilemez!\"); \n        \n        payable(organizer).transfer(address(this).balance);\n    }\n\n    /// ğŸŸ¢ KapÄ±daki turnike / gÃ¶revli iÃ§in:\n    /// KullanÄ±cÄ±nÄ±n biletini tek seferlik \"kullanÄ±lmÄ±ÅŸ\" iÅŸaretler.\n    function useTicket(address user) external {\n        require(msg.sender == organizer, \"Sadece organizator kullanabilir\");\n        require(!isCancelled, \"Etkinlik iptal edildi\");\n        require(hasTicket[user], \"Bu kullanicinin bileti yok\");\n        require(!isTicketUsed[user], \"Bilet zaten kullanilmis\");\n\n        // Ä°stersen zaman penceresi de koyabilirsin:\n        // require(block.timestamp <= eventTimestamp + 1 hours, \"Etkinlik sonrasi bilet kullanilamaz\");\n\n        isTicketUsed[user] = true;\n        emit TicketUsed(user, block.timestamp);\n    }\n}"
      },
      "project/contracts/EventFactory.sol": {
        "content": "// SPDX-License-Identifier: MIT\npragma solidity ^0.8.23;\n\n// AynÄ± klasÃ¶rdeki EventContract dosyasÄ±nÄ± iÃ§eri aktarÄ±yoruz\nimport \"./EventContract.sol\";\n\ncontract EventFactory {\n    EventContract[] public deployedEvents;\n\n    function createEvent(\n        string memory name,\n        string memory date,\n        string memory time,\n        string memory imageURL,\n        string memory locationName,\n        string memory city,\n        string memory country,\n        string memory mapsLink,\n        uint256 price,\n        uint256 capacity,\n        uint256 eventTimestamp \n    ) public {\n        \n        // Yeni kontratÄ± oluÅŸtururken bu zaman bilgisini de gÃ¶nderiyoruz\n        EventContract newEvent = new EventContract(\n            msg.sender,     // organizer\n            name,\n            date,\n            time,\n            imageURL,\n            locationName,\n            city,\n            country,\n            mapsLink,\n            price,\n            capacity,\n            eventTimestamp  \n        );\n        \n        deployedEvents.push(newEvent);\n    }\n\n    function getDeployedEvents() public view returns (EventContract[] memory) {\n        return deployedEvents;\n    }\n}"
      }
    }
  }
}